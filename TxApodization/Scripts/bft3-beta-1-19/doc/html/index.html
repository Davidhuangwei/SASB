<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Beamformation Toolbox III: Beamformation Toolbox III</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li class="current"><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Beamformation Toolbox III </h1><dl class="author"><dt><b>Author:</b></dt><dd>Jens Munk Hansen </dd></dl>
<dl class="date"><dt><b>Date:</b></dt><dd>2011 </dd></dl>
<h2><a class="anchor" id="section_toc">
Table of contents</a></h2>
<ul>
<li>
<a class="el" href="index.html#section_intro">Introduction</a> </li>
<li>
<a class="el" href="index.html#section_beamformation">Beamformation</a> </li>
<li>
<a class="el" href="index.html#section_scanlines">Setting up scan-lines</a> </li>
<li>
<a class="el" href="index.html#section_tof">Time-of-flight calculation</a> <ul>
<li>
<a class="el" href="index.html#section_unfocused">Unfocused beams</a> </li>
<li>
<a class="el" href="index.html#section_focused">Focused beams</a> </li>
<li>
<a class="el" href="index.html#section_fixedfocus">Fixed focusing</a> </li>
<li>
<a class="el" href="index.html#section_ppwave">Plane-wave focusing</a> </li>
</ul>
</li>
<li>
<a class="el" href="index.html#section_apodization">Apodization</a> <ul>
<li>
<a class="el" href="index.html#section_parapodization">Parametric apodization</a> </li>
<li>
<a class="el" href="index.html#section_dynamicapodization">Dynamic apodization</a> </li>
<li>
<a class="el" href="index.html#section_fixedwidthapodization">Fixed width apodization</a> </li>
<li>
<a class="el" href="index.html#section_transmitapodization">Transmit apodization</a> </li>
</ul>
</li>
<li>
<a class="el" href="index.html#section_examples">Examples</a> <ul>
<li>
<a class="el" href="index.html#section_drf">Dynamic receive focusing</a> </li>
<li>
<a class="el" href="index.html#section_sasb">Synthetic aperture sequential beamformation (SASB)</a> </li>
</ul>
</li>
<li>
<a class="el" href="index.html#section_notclasses">A note on Matlab classes</a> </li>
</ul>
<h2><a class="anchor" id="section_intro">
Introduction</a></h2>
<p>Focusing and apodization are an essential part of signal processing in ultrasound imaging. Although the fundamental principles are simple, the dramatic increase in computational power of CPUs, GPUs, and FPGAs motivates the development of software based beamformers, which further improves image quality (and the accuracy of velocity estimation). For developing new imaging methods, it is important to establish proof-of-concept before using resources on real-time implementations. With this in mind, an effective and versatile Matlab toolbox written in C++ has been developed to assist in developing new beam formation strategies. It is a general 3D implementation capable of handling a multitude of focusing methods, interpolation schemes, and parametric and dynamic apodization. Despite being flexible, it is capable of exploiting parallelization on a single computer, on a cluster, or on both. On a single computer, it mimics the parallization in a scanner containing multiple beam formers. The focusing is determined using the positions of the transducer elements, presence of virtual sources, and the focus points. For interpolation, a number of interpolation schemes can be chosen, e.g. linear, polynomial, or cubic splines. Apodization can be specified by a number of window functions of fixed size applied on the individual elements as a function of distance to a reference point, or it can be dynamic with an expanding or contracting aperture to obtain a constant F-number, or both. On a standard PC with an Intel Quad-Core Xeon E5520 processor running at 2.26 GHz, the toolbox can beamform 300.000 points using 700.000 data samples in 3 seconds using a transducer with 192 elements, dynamic apodization in transmit and receive, and cubic splines for interpolation. This is 19 times faster than our previous toolbox.</p>
<h2><a class="anchor" id="section_beamformation">
Beamformation</a></h2>
<p>Beamformation without apodization is all about delays computation for a group of signals exploiting that the sum of these signal can be either constructive or destructive. In medical ultrasound imaging, this is done for both the transmitted and the received field. The type of beamformation varies with the geometry of the transducer and the position of the focal points.</p>
<p>For the transmitted field, appropriate delays and possibly an apodization are applied to the transducer elements to construct a number of signals, which sum up constructively at a single focal point. Receive beamformation is similar in the sense that appropriate delays are applied to the signals received from the individual transducer elements and then a weighted sum is performed. Contrary to transmit focusing, when receiving, one can apply a number of delays corresponding to an equal number of focus points. In addition, an apodization can be applied to even out the resolution over a range of depths.</p>
<p>To calculate the delays, we need to compute the time-of-flight for the sound propagating from a transmit origin, to the focal points, and back to the receiving elements and convert this time to a sample index. To do the latter, we need to know the sampling frequency and the speed of sound. The two parameters are set using the <a class="el" href="classbft3__system.html">bft3_system</a> class. </p>
<div class="fragment"><pre class="fragment">   % Setting speed-of-sound and sampling frequency
   fs = 70e6;
   c = 1540;
   globals = <a class="code" href="classbft3__system.html" title="System class.">bft3_system</a>(<span class="charliteral">&#39;c&#39;</span>, c,<span class="stringliteral">&#39;fs&#39;</span> ,fs);
</pre></div><h2><a class="anchor" id="section_scanlines">
Setting up scan-lines</a></h2>
<p>An image is considered as consisting of a number of scan-lines. The scan-lines are constructed using an origin, a direction, and a length. The scan-lines are constructed using the <a class="el" href="classbft3__line.html">bft3_line</a> class. </p>
<dl class="user"><dt><b>Example</b></dt><dd><div class="fragment"><pre class="fragment"> single_line = <a class="code" href="classbft3__line.html" title="Line class.">bft3_line</a>([0 0 0], [0 0 1], c/fs, 40/1000);
</pre></div></dd></dl>
<h2><a class="anchor" id="section_tof">
Time-of-flight calculation</a></h2>
<p>As just stated, we need to compute the time-of-flight for the sound propagating from the transmit origin, to the focal points and return to the receiving elements. Using the toolbox the transmit origin is set using the <a class="el" href="classbft3__aperture.html#a5274d3bf284fa1b637858d0cc6250391">bft3_aperture::center_focus</a> property on the transmit aperture, which is constructed using the constructor <a class="el" href="classbft3__aperture.html#a1d4a8467f6b661d77cffbb90bc92bf38">bft3_aperture::bft3_aperture</a>. </p>
<dl class="user"><dt><b>Example</b></dt><dd><div class="fragment"><pre class="fragment">   f0 = 5e6; lambda = c/f0;
   pitch = lambda;
   xmt_aperture = <a class="code" href="classbft3__aperture.html" title="Aperture class.">bft3_aperture</a>(<span class="stringliteral">&#39;type&#39;</span>,<span class="stringliteral">&#39;linear_array&#39;</span>,<span class="stringliteral">&#39;pitch&#39;</span>,pitch,...
                                <span class="stringliteral">&#39;n_elements&#39;</span>,64);
</pre></div><ul>
<li>Note the positions of the transmit aperture are only used for transmit apodization, see <a class="el" href="index.html#section_apodization">Apodization</a> for details</li>
</ul>
</dd></dl>
<h3><a class="anchor" id="section_unfocused">
Unfocused beams</a></h3>
<p>The task of computing the time-of-flight can be split into computing a transmit and a receive time corresponding to a transmit and a receive focus, <img class="formulaInl" alt="$t_{\mathrm{\scriptscriptstyle{TOF}}} = t_{\mathrm{\scriptscriptstyle{TOF}}_{\mathrm{xmt}}}+t_{\mathrm{\scriptscriptstyle{TOF}}_{\mathrm{rcv}}}$" src="form_0.png"/>. Assuming the speed of sound, <img class="formulaInl" alt="$c$" src="form_1.png"/> is constant, we get </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{eqnarray}\label{eq:q} t_{\mathrm{\scriptscriptstyle{TOF}}}&amp;=&amp; t_{\mathrm{\scriptscriptstyle{TOF}}_{\mathrm{xmt}}} + t_{\mathrm{\scriptscriptstyle{TOF}}_{\mathrm{rcv}}}\nonumber \\ &amp;=&amp;\frac{\left|\vec{r}_{\mathrm{fp}}-\vec{r}_{\mathrm{xmt}}\right|+\left|\vec{r}_{\mathrm{rcv}}-\vec{r}_{\mathrm{fp}}\right|}{c}. \end{eqnarray}" src="form_2.png"/>
</p>
<p> If secondary scattering is neglected, the receive path is a straight line and the receive time is uniquely determined. The transmit path however is not well defined, since the emitted pressure wave does not emanate from a point source <img class="formulaInl" alt="$\vec{r}_{\mathrm{\scriptscriptstyle{fp}}_{\mathrm{xmt}}}$" src="form_3.png"/> as indicated in Fig. 1 but rather from a complicated pattern resulting from numerous waves emitted from different elements at different times obeying Huygens' principle. For an unfocused beam though, (1) is close to correct. To consider an unfocused beam, the <a class="el" href="classbft3__aperture.html#ae95ef5465358a2cb52ad21c42952c745">bft3_aperture::focus</a> property must be empty on the transmit aperture. </p>
<div class="fragment"><pre class="fragment">   xmt_aperture.focus = [];
</pre></div> <h3><a class="anchor" id="section_focused">
Focused beams</a></h3>
<p>For a focused beam, the transmit time can be approximated by considering the transmit focal point <img class="formulaInl" alt="$\vec{r}_{\mathrm{\scriptscriptstyle{fp}}_{\mathrm{xmt}}}$" src="form_3.png"/> as a virtual point source emitting a spherical wave. By using this approximation, the <img class="formulaInl" alt="$t_{\mathrm{\scriptscriptstyle{TOF}}}$" src="form_4.png"/> becomes </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation}t_{\mathrm{\scriptscriptstyle{TOF}}}=\frac{\left|\vec{r}_{\mathrm{fp}_{\mathrm{xmt}}}-\vec{r}_{\mathrm{xmt}}\right|\pm \left|\vec{r}_{\mathrm{fp}}-\vec{r}_{\mathrm{fp}_{\mathrm{xmt}}}\right|+\left|\vec{r}_{\mathrm{rcv}}-\vec{r}_{\mathrm{fp}}\right|}{c},\end{equation}" src="form_5.png"/>
</p>
<p> where the <img class="formulaInl" alt="$\pm $" src="form_6.png"/> in (2) refers to whether the focal point is above or below a plane orthogonal to the center line of the beam. To introduce a virtual source <img class="formulaInl" alt="$\vec{r}_{\mathrm{fp}_{\mathrm{xmt}}}$" src="form_7.png"/>, the <a class="el" href="classbft3__aperture.html#ae95ef5465358a2cb52ad21c42952c745">bft3_aperture::focus</a> property on the transmit aperture should be set to the given position. </p>
<div class="fragment"><pre class="fragment">   xmt_aperture.focus = [0 0 40/1000];
</pre></div><div align="center">
<img src="focused_below.png" alt="focused_below.png"/>
<p><strong>Fig. 1a: Focus point below plane</strong></p></div>
 <div align="center">
<img src="focused_above.png" alt="focused_above.png"/>
<p><strong>Fig. 1b: Focus point above plane</strong></p></div>
 <p>For a beam perpendicular to the aperture, the plane deciding the sign in (2) is parallel to the aperture.</p>
<h3><a class="anchor" id="section_fixedfocus">
Fixed focusing</a></h3>
<p>To consider fixed receive focusing, a virtual source can be introduced for the receive aperture </p>
<div class="fragment"><pre class="fragment">   rcv_aperture.focus = [0 0 40/1000];
</pre></div><p> and the <img class="formulaInl" alt="$t_{\mathrm{\scriptscriptstyle{TOF}}}$" src="form_4.png"/> becomes </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation}t_{\mathrm{\scriptscriptstyle{TOF}}}=\frac{\left|\vec{r}_{\mathrm{fp}_{\mathrm{xmt}}}-\vec{r}_{\mathrm{xmt}}\right|\pm \left|\vec{r}_{\mathrm{fp}}-\vec{r}_{\mathrm{fp}_{\mathrm{xmt}}}\right|+\left|\vec{r}_{\mathrm{fp}_{\mathrm{rcv}}}-\vec{r}_{\mathrm{rcv}}\right|\pm \left|\vec{r}_{\mathrm{fp}}-\vec{r}_{\mathrm{fp}_{\mathrm{rcv}}}\right|}{c},\end{equation}" src="form_8.png"/>
</p>
<p> For synthetic aperture sequential beamformation (SASB), the first stage is a fixed focus beamformation stage. </p>
<h3><a class="anchor" id="section_ppwave">
Plane-wave focusing</a></h3>
<p>For plane-wave beamformation, the <img class="formulaInl" alt="$t_{\mathrm{\scriptscriptstyle{TOF}}_{\mathrm{xmt}}}$" src="form_9.png"/> is computed using the distance to the plane of emission and the <img class="formulaInl" alt="$t_{\mathrm{\scriptscriptstyle{TOF}}}$" src="form_4.png"/> becomes </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation}t_{\mathrm{\scriptscriptstyle{TOF}}}=\frac{\left|\left(\vec{r}_{\mathrm{fp}_{\mathrm{xmt}}}-\vec{r}_{\mathrm{xmt}}\right)\cdot \vec{n}\right| + \left|\vec{r}_{\mathrm{rcv}}-\vec{r}_{\mathrm{fp}}\right|}{c},\end{equation}" src="form_10.png"/>
</p>
<p> In the toolbox, this plane is defined as the plane containing the transmit origin <img class="formulaInl" alt="$\vec{r}_{\mathrm{xmt}}$" src="form_11.png"/> set using the <a class="el" href="classbft3__aperture.html#a5274d3bf284fa1b637858d0cc6250391">bft3_aperture::center_focus</a> property on the transmit aperture and perpendicular to a normal vector <img class="formulaInl" alt="$\vec{n}$" src="form_12.png"/>defined using Euler angles following the Z-X'-Z'' convention (See wikipedia <a href="http://en.wikipedia.org/wiki/Euler_angles">Euler angles</a>). The normal vector is set using the <a class="el" href="classbft3__aperture.html#a1bad2828c75bc70db0d52ca004f0a536">bft3_aperture::orientation</a> property on the transmit aperture. </p>
<div align="center">
<img src="plane_wave.png" alt="plane_wave.png"/>
<p><strong>Fig. 2: Plane-wave focusing</strong></p></div>
 <p>The result of beamforming a single point is a weighted sum of contributions for each transmit-receive channel pair. For imaging, we are interested in the absolute values and typically, we would either beamform complex data and compute the absolute or beamform a scan line of points and compute the envelope. For velocity estimation, we are interested in the phase and would therefore beamform densely sampled lines and possibly also in multiple directions, the latter for directional velocity estimation.</p>
<h2><a class="anchor" id="section_apodization">
Apodization</a></h2>
<p>In addition to focusing, beamformation also includes apodization, i.e. the possibility for tapering of the individual receive channels and also a possible overall scaling for an emission used for synthetic aperture imaging. If we include apodization, a beamformed image point at position <img class="formulaInl" alt="$\vec{r}_{\mathrm{fp}}$" src="form_13.png"/> is computed according to </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation}I\left(\vec{r}_{\mathrm{fp}}\right)=\sum_{\mathrm{xmt}=1}^{N_{\mathrm{xmt}}}\mathcal{A}_{\mathrm{xmt}}\left(\vec{r}_{\mathrm{fp}}\right)\sum_{\mathrm{rcv}=1}^{N_{\mathrm{rcv}}}\mathcal{A}_{\mathrm{rcv}}\left(\vec{r}_{\mathrm{fp}}\right)s_{\mathrm{xmt},\mathrm{rcv}}\left(t_{\mathrm{\scriptscriptstyle{TOF}}}\left(\vec{r}_{\mathrm{xmt}},\vec{r}_{\mathrm{fp}_{\mathrm{xmt}}},\vec{r}_{\mathrm{fp}},\vec{r}_{\mathrm{rcv}}\right) \right)\end{equation}" src="form_14.png"/>
</p>
<p> where <img class="formulaInl" alt="$N_{\mathrm{rcv}}$" src="form_15.png"/> is the number of receiving elements, <img class="formulaInl" alt="$\mathcal{A}(\vec{r}_{\mathrm{fp}})$" src="form_16.png"/> is the apodization function in transmit and receive, and <img class="formulaInl" alt="$s_{\mathrm{xmt},\mathrm{rcv}}(t)$" src="form_17.png"/> is the interpolated time-domain echo signal received at element <img class="formulaInl" alt="$\mathrm{xmt}$" src="form_18.png"/> after the <img class="formulaInl" alt="$\mathrm{rcv}$" src="form_19.png"/>'th emission. <img class="formulaInl" alt="$N_{\mathrm{xmt}}$" src="form_20.png"/> is the number of emissions used to construct the image point, where the origin of the emissions are spatially different, which is used in synthetic transmit aperture imaging. For a conventional B-mode image, <img class="formulaInl" alt="$N_{\mathrm{xmt}}=1$" src="form_21.png"/>.</p>
<p>In the toolbox the <a class="el" href="classbft3__apodization.html">bft3_apodization</a> class holds the defining properties of the tapering of the individual receive channels and the information for a possible overall scaling for an emission used for synthetic aperture imaging. An apodization is defined for each scan-line for both the transmitting and receiving aperture. The <a class="el" href="classbft3__apodization.html">bft3_apodization</a> class support two ways of tapering and the resulting apodization is the product thereof.</p>
<h3><a class="anchor" id="section_parapodization">
Parametric apodization</a></h3>
<p>It can be defined completely in the sense that the user can define a number of windows (<a class="el" href="classbft3__apodization.html#a7dd9cf05f55ed9e9166d5073552a4b16">bft3_apodization::values</a>) to be applied for a number of range intervals, the range being defined as the distance (<a class="el" href="classbft3__apodization.html#ab1386f9a085a2fe68fcf2984eabd794f">bft3_apodization::distances</a>) from an apodization reference point (<a class="el" href="classbft3__apodization.html#ae69d7eb21a36227a6de7034a9ca01225">bft3_apodization::ref</a>) to the focus point. This makes it possible to a apply simple apodization or extraordinary apodization functions. Parametric apodization is enabled when the <a class="el" href="classbft3__apodization.html#a80fbf72fd4796a85c6328e364dd732c6">bft3_apodization::parametric</a> property is enabled (default = true). </p>
<dl class="user"><dt><b>Example</b></dt><dd><div class="fragment"><pre class="fragment"> % Construct apodization <span class="keywordtype">object</span> to be used <span class="keywordflow">for</span> a single line
 rcv_apodization = <a class="code" href="classbft3__apodization.html" title="Apodization class.">bft3_apodization</a>(rcv_aperture, [0 0 0], 0, ones(64,1));
</pre></div></dd></dl>
<h3><a class="anchor" id="section_dynamicapodization">
Dynamic apodization</a></h3>
<p>The second possibility is dynamic apodization with an expanding and contracting aperture defined using an F-number (<a class="el" href="classbft3__apodization.html#aa6426aaf6e7aeccead495c72e846b49c">bft3_apodization::f</a>), an analytical window function (<a class="el" href="classbft3__apodization.html#a0d54c480cf0b2ff040feac9701c1812a">bft3_apodization::window</a>), and the apodization reference (<a class="el" href="classbft3__apodization.html#ae69d7eb21a36227a6de7034a9ca01225">bft3_apodization::ref</a>). The width of an active sub-aperture for a given focus point is then computed using the distance to the apodization reference and the F-number. If the active sub-aperture extends outside the physical aperture, then only an inner fraction of the apodization window are applied as illustrated in Fig. 3.</p>
<p>Apodization object are constructed using the constructor <a class="el" href="classbft3__apodization.html#a4009b24df58358c44b882baddc64bfe3">bft3_apodization::bft3_apodization</a> by specifying an aperture, a reference point, a number of distances, and a set of apodization <a class="el" href="classbft3__apodization.html#a7dd9cf05f55ed9e9166d5073552a4b16">bft3_apodization::values</a>. See <a class="el" href="classbft3__apodization.html">bft3_apodization</a> for further details.</p>
<dl class="user"><dt><b>Example</b></dt><dd><div class="fragment"><pre class="fragment"> % Disable parametric and enable dynamic apodization
 rcv_apodization.parametric = <span class="keyword">false</span>;
 rcv_apodization.dynamic = <span class="keyword">true</span>;
 rcv_apodization.f = 1.2;
</pre></div> It is important to construct two independent apodization objects for each line if multi-threading is desired. The number of execution threads is set using the <a class="el" href="classbft3__image.html#a3e01320af69b908ff87d04096808ba0c">bft3_image::nthreads</a> property of the <a class="el" href="classbft3__image.html">bft3_image</a> class.</dd></dl>
<div align="center">
<img src="sa_apodization.png" alt="sa_apodization.png"/>
<p><strong>Fig. 3: Apodization calculation</strong></p></div>
 <p>In Fig. 3, the wave propagation paths for transmit-receive element pairs for two different focal points are shown. In addition, an apodization profile is calculated corresponding to a common F-number for the two depths (The F-numbers used for transmit and receive can of course also be different as well as the window functions). The apodization values for the elements is determined by the orthogonal distance from their positions to the apodization line as indicated by the intersections between the dashed lines and the two apodization profiles. Note that for the focal point <img class="formulaInl" alt="$\vec{r}_{\mathrm{fp}_{2}}$" src="form_22.png"/>, we are running out of aperture and an edge-wave will most likely appear in the image. A possible way to deal with such edge-waves is to use enable both dynamic and parametric apodization and the resulting apodization will be the product.</p>
<h3><a class="anchor" id="section_fixedwidthapodization">
Fixed width apodization</a></h3>
<p>Fixed-width apodization is only available for images constructed using the <a class="el" href="classbft3__sampled__image.html">bft3_sampled_image</a> class. It is an experimental feature and only supported for apertures constructed with the <a class="el" href="classbft3__aperture.html#a7dc12b0aab52d3f92c08311d16b3d686">bft3_aperture::type</a> qualifier equal to 'linear_array'. The apodization is computed with a width corresponding to <a class="el" href="classbft3__apodization.html#a3de0731372adcf5e495c9387808254a9">bft3_apodization::n_active_elements</a> and arranged symmetrically around a line from <a class="el" href="classbft3__apodization.html#ae69d7eb21a36227a6de7034a9ca01225">bft3_apodization::ref</a> to the focus point. The individual elements are then tapered according to their orthogonal distance to this line.</p>
<h3><a class="anchor" id="section_transmitapodization">
Transmit apodization</a></h3>
<p>Transmit apodization can likewise be parametric or dynamic. For a dynamic apodization, the dynamic width of the sub-aperture is computed using the transmit F-number <a class="el" href="classbft3__apodization.html#aa6426aaf6e7aeccead495c72e846b49c">bft3_apodization::f</a>, the distance from the focus point to the apodization reference <a class="el" href="classbft3__apodization.html#ae69d7eb21a36227a6de7034a9ca01225">bft3_apodization::ref</a>. The apodization is then computed using the orthogonal distance from the virtual source of the emission to the line from the apodization reference <a class="el" href="classbft3__apodization.html#ae69d7eb21a36227a6de7034a9ca01225">bft3_apodization::ref</a> to the focus point.</p>
<p>For the moment the position of the virtual sources are specified as the positions of transducer element on the transmit aperture and the position used for an emission is specified when calling the <a class="el" href="classbft3__image.html#add523da310e8c21955ef5f1cb935c257">bft3_image::beamform</a> function. The reason why we don't use the <a class="el" href="classbft3__aperture.html#a5274d3bf284fa1b637858d0cc6250391">bft3_aperture::center_focus</a> is that for an unfocused emission, we start sampling after all elements have fired and at this time the wave-front is on the surface of the aperture, whereas the virtual source of the emission is somewhere behind the transducer surface. </p>
<dl class="user"><dt><b>Example</b></dt><dd><div class="fragment"><pre class="fragment"> % Beamformation of single-line image
 img = <a class="code" href="classbft3__image.html" title="Image class.">bft3_image</a>(xmt_aperture, rcv_aperture, xmt_apodization, rcv_apodization, single_line);
 % Dynamic transmit apodization (<span class="keywordflow">if</span> enabled) uses the <span class="keyword">virtual</span> origin located at the 32<span class="stringliteral">&#39;th transducer element</span>
<span class="stringliteral"> rf_line = img.beamform(rf_data, tstart, uint32(32));</span>
</pre></div></dd></dl>
<h2><a class="anchor" id="section_examples">
Examples</a></h2>
<p>A number of examples exist in the examples directory. </p>
<h3><a class="anchor" id="section_drf">
Dynamic receive focusing</a></h3>
<p>An example for simulating data with Field II and beamforming an image using dynamic receive focusing is given in <a href="../../examples/psf_8804p.m" type="text/plain">psf_8804p.m</a> </p>
<h3><a class="anchor" id="section_sasb">
Synthetic aperture sequential beamformation (SASB)</a></h3>
<p>An example for simulating data with Field II and beamforming an image using SASB is given in <a href="../../examples/psf_sasb_8804.m" type="text/plain">psf_sasb_8804.m</a></p>
<h2><a class="anchor" id="section_notclasses">
A note on Matlab classes</a></h2>
<p>All functions with the following prototype</p>
<table  class="memname">
<tr>
<td class="memname">function set <a href="classbft3__aperture.html#ae95ef5465358a2cb52ad21c42952c745" class="el">some_class::some_property</a>  </td><td>( </td><td class="paramtype">in&nbsp; </td><td class="paramname"><em>obj</em>,   </td></tr>
<tr>
<td class="paramkey"></td><td></td><td class="paramtype">in&nbsp; </td><td class="paramname"><em>data</em></td><td>&nbsp;  </td></tr>
<tr>
<td></td><td>) </td><td></td><td></td><td></td></tr>
</table>
<p>can be invoked using the assignment operator </p>
<div class="fragment"><pre class="fragment">   some_object.some_property = data;
</pre></div><p> Similarly all functions with the prototype</p>
<table  class="memname">
<tr>
<td class="memname">function get <a href="classbft3__aperture.html#ae95ef5465358a2cb52ad21c42952c745" class="el">some_class::some_property</a>  </td><td>( </td><td class="paramtype">in&nbsp; </td><td class="paramname"><em>obj</em> </td><td>&nbsp;)&nbsp; </td><td></td></tr>
</table>
<p>can be invoked using left value assignment </p>
<div class="fragment"><pre class="fragment">   variable_name = some_object.some_property;
</pre></div> </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Aug 12 11:15:55 2011 for Beamformation Toolbox III by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
